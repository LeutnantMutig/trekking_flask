<!DOCTYPE html>
<html>
<head>
  <title>Live Tracking</title>
  <style>
    #map { height: 100vh; width: 100%; }
  </style>
  <!-- Insert your real Google Maps API key below -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB-iuuBumLMARemwQylSooVr-poJPiECC8"></script>
</head>
<body>
  <h2>üìç Live Location Tracking</h2>
  <div id="map"></div>

  <script>
    // Flask provides user_id into the template
    const userId = {{ user_id }};
    let map, marker;

    function initMap(lat, lon) {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: lat, lng: lon },
        zoom: 14
      });
      marker = new google.maps.Marker({
        position: { lat: lat, lng: lon },
        map: map
      });
    }

    async function fetchLocation() {
      try {
        const res = await fetch(`/track-data/${userId}`);
        const data = await res.json();

        if (data.status === "success") {
          const pos = { lat: data.lat, lng: data.lon };
          if (!marker) {
            initMap(data.lat, data.lon);
          } else {
            marker.setPosition(pos);
            map.setCenter(pos);
          }
        } else {
          console.warn("‚ö†Ô∏è No location yet:", data.message);
        }
      } catch (err) {
        console.error("‚ùå Error fetching location:", err);
      }
    }

    // Refresh every 5 seconds
    setInterval(fetchLocation, 5000);
    fetchLocation();
  </script>
</body>
</html>


{% comment %} trry kar {% endcomment %}